# 1.需求分析和创建表结构
明确要求，确立了两个主要对象：商品和订单。商品表包括商品名、商品价格、商品库存字段，订单表则包含订单ID、下单时间、总价字段。同时分析两者之间的关系，明确订单和商品之间是多对多的关联关系，即一个订单包含多个商品，一个商品可能被多个订单所购买。因此需要一个新的关联表来存储这个关系。所以，我们需要创建三个表：商品表、订单表和关联表。关联表包括订单id、商品名、所需数量三个字段。商品表的主键为商品名称，订单表的主键为订单ID，关联表的复合主键为订单ID和商品名称。在表的建立过程，不选择插入物理外键，而是通过函数逻辑的使用来实现三表之间的关联。

# 2.功能实现和模块设计
在创建数据库和相应的表后，根据要求，创建了对应的模块和函数管理数据库来实现我们想要实现的功能。

## 2.1 JDBC工具类以及工具函数
首先，创建了一个名为JDBCUtil的类，用于封装JDBC操作的代码。这个类包含一些静态方法，用于获取数据库连接、执行SQL语句、关闭连接等。

2.1.1 获取数据库连接和释放资源
<br>简单的获取数据库连接和释放资源函数。

2.1.2 SQL修改函数
<br>用于执行SQL语句修改对应的记录，并返回受影响的行数。重载出两个函数，两者共同接受参数，第一个参数为SQL语句，第二个参数为SQL语句中的参数列表。但是其中一者函数的参数列表还包括了Connection对象（用于传递数据库连接）和Statement对象，这是为了方便在其他函数内部使用，防止不合理的开启和关闭数据库连接。

2.1.3 SQL查询函数
<br>用于执行SQL语句查询对应的记录，并返回查询结果集。同样重载出两个函数，两者共同接受参数，第一个参数为SQL语句，第二个参数为SQL语句中的参数列表。重载的目的和SQL修改函数一样。同时这一段代码中利用了java反射的机制，将resultset的结果集转换为我们需要的实体对象集(这一段本想简单的返回resultset，看到别人代码的亮点所以自己也试着写了插进来，对反射的理解只是初步)，使得这个函数更加灵活且对使用者更加友好。还有一个简单的检查所需产品或者订单是否存在表中的查询函数，返回boolean值。

2.1.4 事务管理函数
<br>简单的事务管理函数，负责开启事务、提交事务和回滚事务。

## 2.2 商品管理模块

2.2.1 商品添加函数
<br>用于向商品表中添加一条新的商品记录，若是添加的商品名在表中已经存在，则抛出对应异常。同时，对商品价格和库存进行非负数校验，若校验不通过，则抛出对应异常。最后执行SQL语句修改商品表。

2.2.2 商品删除函数
<br>用于删除商品表中指定商品的记录，若要删除的商品不存在，则抛出对应异常。其中特别注意delete操作时，需要先判断该商品是否被其他订单所购买，若被购买，则抛出对应异常并不予删除。最后执行SQL语句修改商品表。

2.2.3 商品查询函数
<br>用于查询商品表中指定商品的记录，若要查询的商品不存在，则抛出对应异常。最后执行SQL语句查询商品表。

2.2.4 查询商品根据价格排序的函数
<br>将商品根据价格进行排序，并返回排序后的商品列表。若是商品表为空,则给与用户提示信息。

2.2.5 修改商品的价格函数
<br>用于修改商品表中指定商品的价格。若要修改的商品不存在或是价格不合理，则抛出对应异常。最后执行SQL语句修改商品表。

2.2.6 修改商品的库存函数
<br>用于修改商品表中指定商品的库存。若要修改的商品不存在或是库存不合理，则抛出对应异常。最后执行SQL语句修改商品表。

## 2.3 订单管理模块

2.3.1 订单添加函数
<br>这个函数用于向订单表中添加一条新的订单记录，同时因为修改数据较多，所以使用了事务管理函数，保证数据的完整性和一致性。函数接受商品类的数组和int类型的参数，分别代表要购买的商品列表和订单id。首先，函数检查id号是否为负数，若为负数，则抛出对应异常。然后，函数遍历商品列表，对每个商品进行查询和库存校验，若查询失败或库存不足亦或是订单要求数量为负数，则抛出对应异常，否则计算累计的总价并更新商品库存。最后，函数执行SQL语句修改订单表并向订单-商品关联表中插入对应的新记录。

2.3.2 订单删除函数
<br>这个函数用于删除订单表中指定订单的记录，因为时间原因，默认删除订单的函数是在订单交付完成后进行的，无需更改商品库存，所以这个函数的逻辑比较简单，直接执行SQL语句删除订单表和订单-商品关联表中的对应记录即可。若是复杂情况，设计的删除操作需要增加订单对应商品的库存数量。同时若是找不到订单的id，则抛出对应异常。

2.3.3 订单查询函数
<br>此函数用于查询订单表中指定订单的记录，若要查询的订单不存在，则抛出对应异常。最后执行SQL语句查询订单表。

2.3.4 查询订单根据价格排序的函数
<br>将订单根据价格进行排序，并返回排序后的订单列表。若是订单表为空,则给与用户提示信息。

2.3.5 查询订单根据下单时间排序的函数
<br>将订单根据下单时间进行排序，并返回排序后的订单列表。若是订单表为空,则给与用户提示信息。

# 3.异常处理和单元测试

## 3.1 异常类的设计

3.1.1 ProductExistException类
<br>商品存在类异常，广泛用于表示因商品存在或不存在导致操作无法进行的异常情况。比如：添加商品时，若商品已经存在，则抛出此异常。删除订单时，若商品不存在或存在于订单时，则抛出此异常。若有时间，会对异常类继续细化，分为存在或不存在的两种情况。

3.1.2 OrderExistException类
<br>订单存在类异常，广泛用于表示因订单存在或不存在导致操作无法进行的异常情况。比如：添加订单时，若订单已经存在，则抛出此异常。删除订单时，若订单不存在，则抛出此异常。若有时间，会对异常类继续细化，分为存在或不存在的两种情况。

3.1.3 DataErrorException类
<br>数据错误类异常，广泛用于表示因数据错误导致操作无法进行的异常情况。比如：添加订单时，若订单要求数量为负数，则抛出此异常。若商品价格或库存为负数，则抛出此异常。若有时间，会对异常类继续细化，分为各种类型的异常，如价格异常，库存异常等。

## 3.2 单元测试

分为商品管理模块的单元测试和订单管理模块的单元测试。测试了各模块的每一个函数，同时对各种可能的抛出的异常情况以及成功的情况进行了全面的测试，通过断言方法或是显示错误信息来判断测试结果。




